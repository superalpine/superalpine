<!doctype html>
<html lang="en">
<head>
    <title id="page-title">Resource database - Super Alpine</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<nav>
    <a href="../index.html">Super Alpine</a>
    <div><a href="index.html">Index</a></div>
</nav>
<main class="resource">
    <div>
        <img id="image" src="">
    </div>
    <div>
        <h1 id="title"></h1>
        <p id="description"></p>
    </div>
</main>
<footer class="columns">
    <div>
        <p>Copyright &copy; Super Alpine. All rights reserved</p>
    </div>
    <div>
        <p><a href="../terms.html">Terms &amp; Conditions</a></p>
    </div>
</footer>
<script>
    function getUrlParameter(name) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(name);
    }

    function fetchCSV() {
        const csvFileUrl = 'data.csv'; // Ensure this matches the path to your CSV file

        fetch(csvFileUrl)
            .then(response => response.text())
            .then(data => {
                parseCSV(data);
            })
            .catch(error => {
                console.error('Error fetching the CSV file:', error);
            });
    }

    function parseCSV(csvData) {
        Papa.parse(csvData, {
            header: true,
            dynamicTyping: true,
            complete: function(results) {
                const lineNumber = parseInt(getUrlParameter('line'), 10);
                if (!isNaN(lineNumber) && lineNumber > 0 && lineNumber <= results.data.length) {
                    displayData([results.data[lineNumber - 1]]);
                } else {
                    alert('Invalid line number');
                }
            }
        });
    }

    function displayData(data) {
        if (data.length > 0) {
            const row = data[0];
            const keys = Object.keys(row);
            if (keys.length > 0) {
                document.getElementById('title').innerText = row[keys[0]];
                document.getElementById('page-title').innerText = row[keys[0]] + ' - Super Alpine';
                if (keys.length > 1) {
                    document.getElementById('description').innerText = row[keys[1]];
                }
                if (keys.length > 2) {
                    document.getElementById('image').src = row[keys[2]];
                }
            }
        }
    }

    // Fetch and process the CSV file when the page loads
    window.onload = fetchCSV;
</script>
</body>
</html>